;/*FB_PKG_DELIM*/

__d("StoriesCometCardStatusSubscription_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9611477815632391"}),null);
__d("StoriesCometCardStatusSubscription.graphql",["StoriesCometCardStatusSubscription_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{kind:"Variable",name:"data",variableName:"input"}],d={alias:null,args:null,concreteType:"StoryCardStoryInfo",kind:"LinkedField",name:"story_card_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"thread_status",storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"StoriesCometCardStatusSubscription",selections:[{alias:null,args:c,concreteType:"StoryCardStatusSubscribeResponsePayload",kind:"LinkedField",name:"story_card_status_subscribe",plural:!1,selections:[{alias:null,args:null,concreteType:"Story",kind:"LinkedField",name:"story",plural:!1,selections:[d],storageKey:null}],storageKey:null}],type:"Subscription",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"StoriesCometCardStatusSubscription",selections:[{alias:null,args:c,concreteType:"StoryCardStatusSubscribeResponsePayload",kind:"LinkedField",name:"story_card_status_subscribe",plural:!1,selections:[{alias:null,args:null,concreteType:"Story",kind:"LinkedField",name:"story",plural:!1,selections:[d,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:b("StoriesCometCardStatusSubscription_facebookRelayOperation"),metadata:{subscriptionName:"story_card_status_subscribe"},name:"StoriesCometCardStatusSubscription",operationKind:"subscription",text:null}}}();e.exports=a}),null);
__d("StoriesCometCardStatusSubscription",["CometRelay","StoriesCometCardStatusSubscription.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h!==void 0?h:h=b("StoriesCometCardStatusSubscription.graphql");function a(a,b,c){b={input:b};return d("CometRelay").requestSubscription(a,{onNext:c,subscription:i,variables:b})}g.subscribe=a}),98);
__d("StoriesCreateAltTextTransformer",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){var d;a=a.altTextData;var e=(a==null?void 0:a.selection)==="CUSTOM"&&(a==null?void 0:a.customText)!=null&&a.customText.trim()!=="",f=b==null||(d=b.attachments)==null?void 0:d[0];if(!f||!e){c(b);return}if(f.photo){a=babelHelpers["extends"]({},f,{photo:babelHelpers["extends"]({},f.photo,{custom_accessibility_caption:a==null?void 0:a.customText,id:((e=f.photo)==null?void 0:e.id)||""})})}else a=f;f=babelHelpers["extends"]({},b,{attachments:[a].concat(((e=b.attachments)==null?void 0:e.slice(1))||[])});c(f)}f["default"]=a}),66);
__d("StoriesCreatePhotoUploadUtils",["FBLogger","MediaUploadFailureFalcoEvent","QPLUserFlow","QuickPerformanceLogger","StoriesUtils","blueimp-canvas-to-blob","cometComposerMediaUploadLogger","cometUniqueID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;b("blueimp-canvas-to-blob");function a(a,b,c,d){var e;if(b==null||d===(c==null||(e=c.uploadingInfo)==null?void 0:e.photoDescriptorID))return;d=b.bottomColor;c=b.topColor;b=a.getContext("2d");b.save();var f=b.createLinearGradient(0,0,a.width,a.height);c!=null&&f.addColorStop(0,c);d!=null&&f.addColorStop(1,d);b.fillStyle=f;b.fillRect(0,0,a.width,a.height);b.restore()}function e(a,b,d,e){var f=new Image(),g=a.width,h=a.height;f.crossOrigin="Anonymous";f.onerror=function(){var a="Failed to load image: "+b;c("FBLogger")("fbstories").warn(a);e(a)};f.onload=function(){var b=a.getContext("2d");b.save();b.drawImage(f,0,0,g,h);b.restore();d()};f.src=b}function f(a,b,d,e,f){if(d===((d=b.uploadingInfo)==null?void 0:d.photoDescriptorID)){e();return}var g=b.displayedURI;if(g==null){e();return}var h=b.bounds,i=b.rotation,j=a.width,k=a.height;d=i%180!==0?[k,j]:[j,k];var l=d[0],m=d[1],n=new Image();n.crossOrigin="Anonymous";n.onerror=function(){var a="Failed to load image: "+g;c("FBLogger")("fbstories").warn(a);f(a)};n.onload=function(){var b=a.getContext("2d"),c=h.x*l,d=h.y*m,f=h.width*l,g=h.height*m;b.save();b.translate(j/2,k/2);b.rotate(i*Math.PI/180);b.translate(-l/2,-m/2);b.drawImage(n,0,0,n.width,n.height,c,d,f,g);b.restore();e()};n.src=g}function i(a,b,c,d){return[a==null?void 0:a.bottomColor,a==null?void 0:a.topColor,b==null?void 0:b.rotation,b==null?void 0:b.offset.dx,b==null?void 0:b.offset.dy,b==null?void 0:b.scale,c,d].join()}function j(a){if(a<1e5)return"extra-small";else if(a<3e5)return"small";else if(a<5e5)return"medium";else if(a<75e4)return"large";else return"extra-large"}function k(a,b,e,f,g,i,k,l){var m,n=function(a,d){var f=function(){b.successObserver.unsubscribe(g),b.errorObserver.unsubscribe(h)},g=function(b){b.uploadID===a&&(d&&c("cometComposerMediaUploadLogger")({fields:{media_id:b.entID,media_type:"PHOTO"},type:"MEDIA_UPLOAD_SUCCESS"},e),f(),k(b.entID))},h=function(b){b.uploadID===a&&(d&&(c("FBLogger")("fbstories").warn("Photo upload failed: %s",b.error!=null?b.error.toString():""),c("MediaUploadFailureFalcoEvent").log(function(){var a;return{creation_session_id:e,error_info:(a=b.error)==null?void 0:a.toString()}})),f(),l(b.error))};b.successObserver.subscribe(g);b.errorObserver.subscribe(h)};m=(m=f.uploadingInfo)==null?void 0:m.photoDescriptorID;if(m!=null&&g===m){g=f.uploadingInfo;if(g!=null)if(g.entID!=null){k(g.entID);return g.uploadID}else{m=g.uploadID;if(m!=null){n(m,!1);return m}}}var o=c("cometUniqueID")();f=d("StoriesUtils").getBlobImageParams();g=f.format;m=f.quality;a.toBlob(function(a){i!=null&&(h||(h=c("QuickPerformanceLogger"))).markerPoint(i,"blob created");a=a;a.uploadID=o;var d=j(a.size);c("QPLUserFlow").addPoint(c("qpl")._(741087294,"2028"),"Blob created",d!=null?{data:{string:{fileSizeToLog:d}}}:void 0);n(o,!0);c("cometComposerMediaUploadLogger")({fields:{media_id:o,media_type:"PHOTO"},type:"MEDIA_UPLOAD_START"},e);b.upload([{extra:{fileType:"PHOTO"},file:a}])},g,m);return o}g.drawBlurredBackgroundOnCanvas=a;g.drawSATPBackgroundOnCanvas=e;g.drawPhotoOnCanvas=f;g.generatePhotoDescriptorID=i;g.getFileSizeLogName=j;g.uploadPhoto=k}),98);
__d("StoriesCreateBlurredBgTransformer",["QuickPerformanceLogger","StoriesCreatePhotoUploadUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e){var f=a.blurredBg;a=a.photoData;if(f==null||f.topColor==null||f.bottomColor==null){e(b);return}var g=b.canvas,i=b.photoDescriptorID,j=b.qplEvent;d("StoriesCreatePhotoUploadUtils").drawBlurredBackgroundOnCanvas(g,f,a,i);j!=null&&(h||(h=c("QuickPerformanceLogger"))).markerPoint(j,"blurred background drawn to canvas");e(b)}g["default"]=a}),98);
__d("StoriesCreateCTALinkTransformer",["StoriesCreateMediaTypeEnum"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d){var e;if(((e=a.formData)==null?void 0:e.mediaType)!==c("StoriesCreateMediaTypeEnum").PHOTO&&((e=a.formData)==null?void 0:e.mediaType)!==c("StoriesCreateMediaTypeEnum").VIDEO||((e=a.ctaLinkData)==null?void 0:e.ctaType)==null||((e=a.ctaLinkData)==null?void 0:e.link)==null){d(b);return}d(babelHelpers["extends"]({},b,{call_to_action_data:{is_cta_share_post:!0,link:a.ctaLinkData.link,page:a.ctaLinkData.page,type:a.ctaLinkData.ctaType}}))}g["default"]=a}),98);
__d("StoriesCreateGenAILabelTransformer",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){a=a.genAISelfDisclosureData;c(babelHelpers["extends"]({},b,{ai_generated_self_disclosure_metadata:{was_self_disclosed_as_ai_generated:(a==null?void 0:a.isSelfDisclosedAsGenAI)===!0}}))}f["default"]=a}),66);
__d("StoriesCreateMusicStoryVideoGenTransformer",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){var d,e=b==null||(d=b.attachments)==null?void 0:d[0];a=(a=a.stickerData)==null?void 0:a.musicSticker;if((e==null?void 0:e.photo)==null||(a==null?void 0:a.song)==null){c(b);return}var f=a.startTime||0;a=a.song.id;var g=e.photo.id;a={audio_asset_id:a,highlight_start_time_ms:f,photo_id:g};g=(f=e.photo)==null||(f=f.overlays)==null?void 0:f.filter(function(a){return a.music_sticker==null});c(babelHelpers["extends"]({},b,{attachments:[{video:{overlays:g,video_generation_params:{music_story:a}}}]}))}f["default"]=a}),66);
__d("StoriesCreateMutation_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="24226878183562473"}),null);
__d("StoriesCreateMutation.graphql",["StoriesCreateMutation_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{kind:"Variable",name:"data",variableName:"input"}],d={alias:null,args:null,kind:"ScalarField",name:"story_id",storageKey:null},e={alias:null,args:null,kind:"ScalarField",name:"logging_token",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"StoriesCreateMutation",selections:[{alias:null,args:c,concreteType:"StoryCreateResponsePayload",kind:"LinkedField",name:"story_create",plural:!1,selections:[d,e,{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"actor",plural:!1,selections:[{kind:"InlineFragment",selections:[{args:null,kind:"FragmentSpread",name:"useProfileCometStoryStatus_user"}],type:"User",abstractKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"StoriesCreateMutation",selections:[{alias:null,args:c,concreteType:"StoryCreateResponsePayload",kind:"LinkedField",name:"story_create",plural:!1,selections:[d,e,{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"actor",plural:!1,selections:[f,{kind:"InlineFragment",selections:[{alias:null,args:[{kind:"Literal",name:"first",value:1}],concreteType:"DirectInboxBroadcastBucketConnection",kind:"LinkedField",name:"story_bucket",plural:!1,selections:[{alias:null,args:null,concreteType:"DirectMessageThreadBucket",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"should_show_close_friend_badge",storageKey:null},g,{alias:null,args:null,concreteType:"Story",kind:"LinkedField",name:"first_story_to_show",plural:!1,selections:[g,{alias:null,args:null,concreteType:"StoryCardSeenState",kind:"LinkedField",name:"story_card_seen_state",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"is_seen_by_viewer",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"story_overlays",plural:!0,selections:[f],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:"story_bucket(first:1)"}],type:"User",abstractKey:null},g],storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:b("StoriesCreateMutation_facebookRelayOperation"),metadata:{},name:"StoriesCreateMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("StoriesCreateOverlayTransformer",["FBLogger","JSResourceForInteraction","QPLUserFlow","QuickPerformanceLogger","StoriesConstants","StoriesGating","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("JSResourceForInteraction")("html2canvas").__setRef("StoriesCreateOverlayTransformer"),j=4,k=290;function a(a,b,e){var f,g=((f=a.stickerData)==null||(f=f.channelSticker)==null?void 0:f.channelStickerMetaData)!=null;if((a.textOverlays==null||a.textOverlays.overlays.length===0)&&(a.stickerData==null||a.stickerData.stickers.length===0)&&!((f=a.stickerData)!=null&&(f=f.musicSticker)!=null&&f.song)&&!g){e(b);return}var l=g,m=b.clonedOverlayNode;if(m==null){c("FBLogger")("fbstories").warn("Overlay transformer missing cloned node");e(b);return}var n=b.canvas,o=b.qplEvent,p=n.getContext("2d");c("promiseDone")(i.load(),function(a){o!=null&&(h||(h=c("QuickPerformanceLogger"))).markerPoint(o,"html2canvas module loaded");var f=document.body;if(f==null){c("FBLogger")("fbstories").warn("Overlay transformer missing document body");e(b);return}f.appendChild(m);c("promiseDone")(a(m,{allowTaint:!1,backgroundColor:l?"null":"rgba(0,0,0,0)",height:l?d("StoriesConstants").DEFAULT_CANVAS_HEIGHT/j:m.offsetHeight,ignoreElements:function(a){var b;if(a.id==="stories-emoji-button")return!0;else if(a.contains(m)||((b=a.parentElement)==null?void 0:b.nodeName)==="HTML"||a===m||m.contains(a)||a instanceof HTMLStyleElement)return!1;else if(a instanceof HTMLLinkElement)return a.as==="script"||a.getAttribute("data-preloader")!=null;else return!0},logging:d("StoriesGating").isEmployee(),onclone:function(a){if(g){Array.from(a.querySelectorAll("*")).forEach(function(a){var b=a.getAttribute("style")||"";a.setAttribute("style",b+"; font-family: Segoe UI, sans-serif !important")});a=a.querySelectorAll('[id="channel-sticker"]')[0];var b=a.getAttribute("style")||"",c=d("StoriesConstants").DEFAULT_CANVAS_HEIGHT/j,e=a.offsetHeight;c=(c-e)/2;a.setAttribute("style",b+("; width: "+k+"px; top: "+c+"px; left: 0%; margin-left: -8px; position: absolute; transform: scale(0.66);"))}},scale:j,useCORS:!0,width:l?d("StoriesConstants").DEFAULT_CANVAS_WIDTH/j:m.offsetWidth}).then(function(a){p.drawImage(a,0,0,n.width,n.height),m.remove(),c("QPLUserFlow").addPoint(c("qpl")._(741087294,"2028"),"Overlays added"),o!=null&&(h||(h=c("QuickPerformanceLogger"))).markerPoint(o,"overlays added"),e(b)}))})}g["default"]=a}),98);
__d("StoriesCreatePhotoTransformer",["QPLUserFlow","QuickPerformanceLogger","StoriesCreateMediaTypeEnum","StoriesCreatePhotoUploadUtils","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e){var f=a.photoData;if(((a=a.formData)==null?void 0:a.mediaType)!==c("StoriesCreateMediaTypeEnum").PHOTO||f==null){e(b);return}a=f.displayedURI;if(a==null){e(b);return}a=b.canvas;var g=b.photoDescriptorID,i=b.qplEvent;d("StoriesCreatePhotoUploadUtils").drawPhotoOnCanvas(a,f,g,function(){c("QPLUserFlow").addPoint(c("qpl")._(741087294,"2028"),"Photo drawn to canvas"),i!=null&&(h||(h=c("QuickPerformanceLogger"))).markerPoint(i,"photo drawn to canvas"),e(b)},function(a){c("QPLUserFlow").endFailure(c("qpl")._(741087294,"2028"),"Photo drawing failed"),b.onTransformError(a)})}g["default"]=a}),98);
__d("StoriesCreatePhotoUploadTransformer",["QPLUserFlow","QuickPerformanceLogger","StoriesCreateMediaTypeEnum","StoriesCreatePhotoUploadUtils","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e){var f,g,i,j,k=a==null||(f=a.mediaAttachments)==null?void 0:f[0],l=a.photoData,m=b.audiences,n=b.canvas,o=b.photoDescriptorID,p=b.qplEvent,q=b.uploader;m=m==null||(g=m[0])==null||(g=g.stories)==null||(g=g.self)==null?void 0:g.target_id;i=((i=a.stickerData)==null||(i=i.channelSticker)==null?void 0:i.channelStickerMetaData)!=null;j=((j=a.formData)==null?void 0:j.mediaType)===c("StoriesCreateMediaTypeEnum").SATP&&((j=a.stickerData)==null?void 0:j.musicSticker)!=null;if(!j&&(k==null?void 0:k.fileType)!=="PHOTO"&&!i||m==null||l==null){e(b);return}var r=[];if(((j=a.stickerData)==null?void 0:j.productSticker)!=null){r.push({product_sticker:(k=a.stickerData)==null?void 0:k.productSticker})}if(((i=a.stickerData)==null?void 0:i.channelSticker)!=null){r.push({channel_sticker:(m=a.stickerData)==null?void 0:m.channelSticker.channelStickerMetaData})}if(((j=a.stickerData)==null?void 0:j.musicSticker)!=null){r.push({music_sticker:(k=a.stickerData)==null?void 0:k.musicSticker.musicStickerMetaData})}if(((i=a.stickerData)==null?void 0:i.tagStickers)!=null)for(j of(m=a.stickerData)==null?void 0:m.tagStickers){r.push({tag_sticker:{bounds:j.bounds,creation_source:j.creation_source,tag_id:j.withTagID,type:j.type}})}d("StoriesCreatePhotoUploadUtils").uploadPhoto(n,q,a.composerSessionID,l,o,p,function(a){c("QPLUserFlow").addPoint(c("qpl")._(741087294,"2028"),"Photo uploaded"),p!=null&&(h||(h=c("QuickPerformanceLogger"))).markerPoint(p,"photo uploaded"),e(babelHelpers["extends"]({},b,{attachments:[{photo:{id:a,overlays:r}}]}))},function(a){c("QPLUserFlow").endFailure(c("qpl")._(741087294,"2028"),"Upload failed"),b.onTransformError(a)})}g["default"]=a}),98);
__d("StoriesCreateSATPBgPhotoTransformer",["QPLUserFlow","QuickPerformanceLogger","StoriesCreatePhotoUploadUtils","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e){var f,g=a.satpData;f=((f=a.stickerData)==null||(f=f.channelSticker)==null?void 0:f.channelStickerMetaData)!=null;a=((a=a.stickerData)==null?void 0:a.musicSticker)!=null;if(!(f||a)||g==null){e(b);return}f=g==null?void 0:g.background;if(f==null){e(b);return}a=b.canvas;var i=b.qplEvent;g=function(){c("QPLUserFlow").addPoint(c("qpl")._(741087294,"2028"),"Photo drawn to canvas"),i!=null&&(h||(h=c("QuickPerformanceLogger"))).markerPoint(i,"SATP background photo drawn to canvas"),e(b)};var j=function(a){c("QPLUserFlow").endFailure(c("qpl")._(741087294,"2028"),"SATP background photo drawing failed"),b.onTransformError(a)};d("StoriesCreatePhotoUploadUtils").drawSATPBackgroundOnCanvas(a,f,g,j)}g["default"]=a}),98);
__d("StoriesCreateSATPCanvasUtils",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d){var e=b.background;if(e==null)return;var f=new Image();f.crossOrigin="Anonymous";f.onerror=function(){var a="Failed to load image: "+e;c("FBLogger")("fbstories").warn(a)};f.onload=function(){var b=a.getContext("2d");b.save();b.drawImage(f,0,0,a.width,a.height);b.restore();d()};f.src=e}g.drawSATPBgOnCanvas=a}),98);
__d("StoriesCreateSATPBgTransformer",["StoriesCreateMediaTypeEnum","StoriesCreateSATPCanvasUtils","StoriesGating","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){var f;if(((f=a.formData)==null?void 0:f.mediaType)!==c("StoriesCreateMediaTypeEnum").SATP||!d("StoriesGating").shouldEnableOptimisticImprovements()){e(b);return}f=b.canvas;a=a==null?void 0:a.satpData;if(a==null)throw c("unrecoverableViolation")("Stories Create mutation SATP Data should not be null/undefined","fb_stories_web");d("StoriesCreateSATPCanvasUtils").drawSATPBgOnCanvas(f,a,function(){e(b)})}g["default"]=a}),98);
__d("StoriesLexicalMentionNode",["CometLexicalGenericEntityNode","stylex"],(function(a,b,c,d,e,f,g){"use strict";var h,i={root:{cursor:"xt0e3qv",textDecoration:"x1bvjpef",$$css:!0}},j=function(a){function b(){return a.apply(this,arguments)||this}babelHelpers.inheritsLoose(b,a);var d=b.prototype;d.createDOM=function(b){b=a.prototype.createDOM.call(this,b);b.className=(h||(h=c("stylex")))([i.root]);b.spellcheck=!1;return b};b.clone=function(a){var c;return new b({id:a.__id,text:a.__text,type:a.__entityType,uri:(c=a.__uri)!=null?c:void 0},a.__key)};b.getType=function(){return"stories-mention"};b.importJSON=function(a){return k({id:a.id,text:a.text,type:a.entityType,uri:(a=a.uri)!=null?a:void 0})};return b}(d("CometLexicalGenericEntityNode").CometLexicalGenericEntityNode);function k(a){return new j(a).setMode("segmented").toggleDirectionless()}function a(a){return a instanceof j}g.StoriesLexicalMentionNode=j;g.$createStoriesLexicalMentionNode=k;g.$isStoriesLexicalMentionNode=a}),98);
__d("calculateMentionStickerBounds",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c,d){var e=(b.left+b.right)/2,f=(b.top+b.bottom)/2,g=c%90*Math.PI/180,h=Math.floor(c/90)%2===1;d=d;var i=h?b.height:b.width;h=h?b.width:b.height;b=1e-5;i=(i-d*Math.sin(g))/Math.max(Math.cos(g),b);h=(h-d*Math.cos(g))/Math.max(Math.sin(g),b);g=Math.min(i,h);b=e-g/2;i=f-d/2;return{height:d/a.height,rotation:c,width:g/a.width,x:(b-a.left)/a.width,y:(i-a.top)/a.height}}f["default"]=a}),66);
__d("createRectsFromDOMRangeWithOverlap",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){a=a.getRootElement();if(a===null)return[];var c=a.getBoundingClientRect();a=getComputedStyle(a);a=parseFloat(a.paddingLeft)+parseFloat(a.paddingRight);b=Array.from(b.getClientRects());var d=b.length;b.sort(function(a,b){var c=a.top-b.top;return Math.abs(c)<=3?a.left-b.left:c});var e;for(var f=0;f<d;f++){var g=b[f],h=g.width+a===c.width;if(h){e=g;b.splice(f--,1);d--;continue}}b.length===0&&e!=null&&b.push(e);return b}f["default"]=a}),66);
__d("StoriesCreateSATPTextTransformer",["FBLogger","Lexical","LexicalSelection","StoriesComposerUtils","StoriesCreateMediaTypeEnum","StoriesLexicalMentionNode","calculateMentionStickerBounds","createRectsFromDOMRangeWithOverlap","extractMessageFromPlainText"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){var f,g;if(((f=a.formData)==null?void 0:f.mediaType)!==c("StoriesCreateMediaTypeEnum").SATP)return e(b);var h=a.lexicalEditor;if(h==null){c("FBLogger")("fb_stories_web").mustfix("Stories Create missing lexical editor during submission");return e(b)}f=b==null||(g=b.attachments)==null?void 0:g.find(function(a){return(a==null?void 0:a.video)!=null});if(!f){f=h.getEditorState().read(function(){return c("extractMessageFromPlainText")()});return e(babelHelpers["extends"]({},b,{message:f}))}var i=(f=a.overlayRef)==null?void 0:f.current,j=[];(f=a.lexicalEditor)==null||f.getEditorState().read(function(){d("Lexical").$nodesOfType(d("StoriesLexicalMentionNode").StoriesLexicalMentionNode).forEach(function(a){if(a!=null){var b=d("LexicalSelection").createDOMRange(h,a,0,a,a.getTextContent().length);if(b!=null){b=c("createRectsFromDOMRangeWithOverlap")(h,b);if(i!=null&&b!=null)for(b of b)j.push({tag_sticker:{bounds:c("calculateMentionStickerBounds")(i.getBoundingClientRect(),b,0,d("StoriesComposerUtils").FONT_SIZE),creation_source:"TEXT_TOOL_MENTION",tag_id:a.getID(),type:"PEOPLE"}})}}})});f=b.attachments!=null&&b.attachments.length>0?(a=b.attachments[0])==null?void 0:a.video:null;if(f==null){c("FBLogger")("fb_stories_web").mustfix("Stories Create missing video data for burned story during submission");return e(b)}return e(babelHelpers["extends"]({},b,{attachments:[{video:babelHelpers["extends"]({},f,{overlays:[].concat((a=f.overlays)!=null?a:[],j)})}]}))}g["default"]=a}),98);
__d("StoriesCreateSATPToPhotoStoryTransformer",["StoriesCreateMediaTypeEnum"],(function(a,b,c,d,e,f,g){"use strict";var h=["message","text_format_metadata","text_format_preset_id"];function a(a,b,d){var e;if(((e=a.formData)==null?void 0:e.mediaType)!==c("StoriesCreateMediaTypeEnum").SATP){d(b);return}a=(e=a.stickerData)==null?void 0:e.musicSticker;if(a==null){d(b);return}b.message;b.text_format_metadata;b.text_format_preset_id;e=babelHelpers.objectWithoutPropertiesLoose(b,h);d(e)}g["default"]=a}),98);
__d("StoriesCreateSATPTransformer",["StoriesCreateMediaTypeEnum","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d){var e;if(((e=a.formData)==null?void 0:e.mediaType)!==c("StoriesCreateMediaTypeEnum").SATP){d(b);return}e=a==null?void 0:a.satpData;if(e==null)throw c("unrecoverableViolation")("Stories Create mutation SATP Data should not be null/undefined","fb_stories_web");d(babelHelpers["extends"]({},b,{message:{ranges:[],text:e.text},text_format_metadata:{inspirations_custom_font_id:e.fontID},text_format_preset_id:e.presetID}))}g["default"]=a}),98);
__d("StoriesCreateVideoUtils",["generateVideoThumbnails","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d){var e=document.createElement("video"),f=a.width,g=a.height;e.style.display="none";e.preload="auto";e.src=b;b=function(){var b=c("generateVideoThumbnails")(e,f,g,1,"cover");c("promiseDone")(b,function(b){var c=new Image();c.crossOrigin="Anonymous";c.onload=function(){var b=a.getContext("2d");b.save();b.drawImage(c,0,0,f,g);b.restore();d()};c.src=b.selectedThumbnail.getURL()})};e.addEventListener("loadeddata",b);e.load()}g.drawVideoThumbnailOnCanvas=a}),98);
__d("StoriesCreateVideoThumbnailTransformer",["StoriesCreateMediaTypeEnum","StoriesCreateVideoUtils","StoriesGating"],(function(a,b,c,d,e,f,g){"use strict";var h=d("StoriesGating").isCometStoriesVideoProductionEnabled();function a(a,b,e){var f,g=a==null||(f=a.mediaAttachments)==null?void 0:f[0];if(!h||((a=a.formData)==null?void 0:a.mediaType)!==c("StoriesCreateMediaTypeEnum").VIDEO||(g==null?void 0:g.fileType)!=="VIDEO"||(g==null?void 0:g.file)==null){e(b);return}a=g==null?void 0:g.fileObjectURL;if(a==null){e(b);return}g=b.canvas;d("StoriesCreateVideoUtils").drawVideoThumbnailOnCanvas(g,a,function(){e(b)})}g["default"]=a}),98);
__d("StoriesCreateVideoTransformer",["cometUniqueID"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d){var e,f,g,h=a==null||(e=a.mediaAttachments)==null?void 0:e[0];if((h==null?void 0:h.fileType)!=="VIDEO"||(h==null?void 0:h.file)==null){d(b);return}var i=b.uploader,j=h==null?void 0:h.file;j.uploadID=c("cometUniqueID")();f=(f=(f=a.videoData)==null?void 0:f.currentDuration)!=null?f:0;g=(g=(g=a.videoData)==null?void 0:g.initialDuration)!=null?g:0;a=(a=(a=a.videoData)==null?void 0:a.startTime)!=null?a:0;var k=null;f!==g&&(k={videoTrimEnd:a+f,videoTrimStart:a});i.successObserver.subscribe(function(a){a.uploadID===j.uploadID&&d(babelHelpers["extends"]({},b,{attachments:[{video:{id:a.entID}}]}))});i.errorObserver.subscribe(function(a){d(b)});i.upload([{extra:{fileType:h.fileType,trimData:k},file:j}])}g["default"]=a}),98);
__d("reduceStoriesCreateViewStateToCreationData",["gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=["canvas","clonedOverlayNode","onTransformError","photoDescriptorID","qplEvent","uploader"];function a(a){var b=window.open("about:blank","image from canvas");b!=null&&b.document.write("<img src='"+a+"' alt='from canvas'/>")}function b(a,b,c,d){function e(c,f){var g=b[f];if(g!=null){var i=function(a){e(a,f+1)};g(a,c,i)}else{g=c.canvas;c.clonedOverlayNode;c.onTransformError;c.photoDescriptorID;c.qplEvent;c.uploader;i=babelHelpers.objectWithoutPropertiesLoose(c,h);d(i,g)}}e(c,0)}g["default"]=b}),98);
__d("storiesUploadUpdater",["CometRelay","StoriesGating","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var e=c("uuidv4")(),f=a.create("client:newNode:"+e,"Story"),g=a.create(c("uuidv4")(),"StoryCardStoryInfo");if(b!=null&&d("StoriesGating").shouldEnableOptimisticImprovements()){a=a.create(c("uuidv4")(),"Image");a.setValue(b,"uri");g.setLinkedRecord(a,"story_thumbnail")}g.setValue("PENDING","thread_status");f.setValue(e,"id");f.setLinkedRecord(g,"story_card_info");return f}function i(a,b){var e=a.create("client:newNode:"+c("uuidv4")(),"UnifiedStoryBucketToUnifiedStoriesConnection");b=h(a,b);a=d("CometRelay").ConnectionHandler.createEdge(a,e,b,"UnifiedStoryBucketToUnifiedStoriesEdge");d("CometRelay").ConnectionHandler.insertEdgeBefore(e,a);return e}function j(a,b,d){var e=c("uuidv4")(),f=a.create("client:newNode:"+e,"StoryBucket");f.setLinkedRecord(b,"story_bucket_owner");b=i(a,d);f.setLinkedRecord(b,"unified_stories");f.setValue(e,"id");return f}function a(a,b,c){b=a.get(b);if(!b)return;var e=b.getOrCreateLinkedRecord("unified_stories_buckets","UserToUnifiedStoryBucketsConnection",{find:"loading",first:1});if(e){b=j(a,b,c);c=d("CometRelay").ConnectionHandler.createEdge(a,e,b,"UserToUnifiedStoryBucketsEdge");c&&d("CometRelay").ConnectionHandler.insertEdgeAfter(e,c)}}g["default"]=a}),98);
__d("StoriesCreateMutation",["CometRelay","QPLUserFlow","QuickPerformanceLogger","StoriesCometCardStatusSubscription","StoriesConstants","StoriesCreateAltTextTransformer","StoriesCreateBlurredBgTransformer","StoriesCreateCTALinkTransformer","StoriesCreateGenAILabelTransformer","StoriesCreateMediaTypeEnum","StoriesCreateMusicStoryVideoGenTransformer","StoriesCreateMutation.graphql","StoriesCreateOverlayTransformer","StoriesCreatePhotoTransformer","StoriesCreatePhotoUploadTransformer","StoriesCreatePhotoUploadUtils","StoriesCreateSATPBgPhotoTransformer","StoriesCreateSATPBgTransformer","StoriesCreateSATPTextTransformer","StoriesCreateSATPToPhotoStoryTransformer","StoriesCreateSATPTransformer","StoriesCreateVideoThumbnailTransformer","StoriesCreateVideoTransformer","StoriesGating","TCometComposerTarget","WebStorage","cometComposerLogger","getComposerLoggingPayload","gkx","qpl","reduceStoriesCreateViewStateToCreationData","storiesUploadUpdater"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=[c("StoriesCreateSATPTransformer"),c("StoriesCreateSATPBgTransformer"),c("StoriesCreateBlurredBgTransformer"),c("StoriesCreateSATPBgPhotoTransformer")].concat(c("gkx")("8841")?[c("StoriesCreateSATPToPhotoStoryTransformer")]:[],[c("StoriesCreateVideoThumbnailTransformer"),c("StoriesCreatePhotoTransformer"),c("StoriesCreateOverlayTransformer"),c("StoriesCreateVideoTransformer"),c("StoriesCreateCTALinkTransformer")],c("gkx")("4703")?[c("StoriesCreateGenAILabelTransformer")]:[],[c("StoriesCreatePhotoUploadTransformer")],d("StoriesGating").shouldEnableAltTextInPhotoStories()?[c("StoriesCreateAltTextTransformer")]:[],c("gkx")("8841")?[c("StoriesCreateMusicStoryVideoGenTransformer")]:[],[c("StoriesCreateSATPTextTransformer")]),l=h!==void 0?h:h=b("StoriesCreateMutation.graphql"),m=d("StoriesGating").isCometStoriesVideoProductionEnabled();function a(a,b,e,f,g,h,o,p,q,r){var s;c("QPLUserFlow").start(c("qpl")._(741087294,"2028"));s=((s=a.stickerData)==null||(s=s.channelSticker)==null?void 0:s.channelStickerMetaData)!=null;var t=d("getComposerLoggingPayload").getStoriesComposerLoggingPayload(a),u={target:{id:b,type:d("TCometComposerTarget").getComposerTargetType("feed")}},v={composerEntryPointName:"channel_sticker_share",composerSourceSurface:"channel_sticker"};c("cometComposerLogger")({fields:babelHelpers["extends"]({},s?v:null,{composerType:"stories",isMyStorySelected:!0,payload:t}),type:"COMPOSER_POST"},a.composerSessionID,u);s=document.createElement("canvas");var w=null,x=d("StoriesCometCardStatusSubscription").subscribe(e,{send_key:a.composerSessionID},function(b){var d;b=b==null||(d=b.story_card_status_subscribe)==null||(d=d.story)==null||(d=d.story_card_info)==null?void 0:d.thread_status;(b==="PUBLISHED"||b==="FAILED")&&(b==="PUBLISHED"?(c("cometComposerLogger")({fields:{destination:"stories"},type:"COMPOSER_POST_SERVER_CONTENT_RENDERED"},a.composerSessionID),h!=null&&(i||(i=c("QuickPerformanceLogger"))).markerEnd(h,2)):h!=null&&(i||(i=c("QuickPerformanceLogger"))).markerEnd(h,3),w&&w.dispose(),x.dispose())});v=function(a){var b=new Error();a!=null&&(b.description=a.toString());h!=null&&(i||(i=c("QuickPerformanceLogger"))).markerEnd(h,3);o(b);w&&w.dispose();x.dispose()};var y={audiences:[{stories:{self:{target_id:b}}}],source:"WWW"},z=d("StoriesGating").shouldEnableOptimisticImprovements();z||(w=n(e,y,b));s.height=d("StoriesConstants").DEFAULT_CANVAS_HEIGHT;s.width=d("StoriesConstants").DEFAULT_CANVAS_WIDTH;t=d("StoriesCreatePhotoUploadUtils").generatePhotoDescriptorID(a.blurredBg,a.photoData,(u=(t=a.textOverlays)==null?void 0:t.overlays.length)!=null?u:0,(u=(t=a.stickerData)==null?void 0:t.stickers.length)!=null?u:0);c("reduceStoriesCreateViewStateToCreationData")(a,k,{audiences:[{stories:{self:{target_id:b}}}],audiences_is_complete:!0,canvas:s,clonedOverlayNode:g,logging:{composer_session_id:a.composerSessionID},navigation_data:r!=null?{attribution_id_v2:r}:null,onTransformError:v,photoDescriptorID:t,qplEvent:h,source:"WWW",uploader:f},function(f,g){var k;z&&(w=n(e,y,b,g.toDataURL()));f.tracking=f.tracking?f.tracking.concat(q):[q];c("cometComposerLogger")({fields:{destination:"stories"},type:"COMPOSER_POST_MUTATION_START"},a.composerSessionID);h!=null&&(i||(i=c("QuickPerformanceLogger"))).markerPoint(h,"mutation started");if(m&&((k=a.formData)==null?void 0:k.mediaType)===c("StoriesCreateMediaTypeEnum").VIDEO&&g!=null){var r;k=(k=f.attachments)==null||(k=k[0])==null||(k=k.video)==null?void 0:k.id;var s=(j||(j=c("WebStorage"))).getSessionStorage();r=JSON.parse((r=s==null?void 0:s.getItem(d("StoriesConstants").CACHED_STORY_THUMBNAIL_URI_SESSION_STORAGE_KEY))!=null?r:"{}");if(k!=null){k=babelHelpers["extends"]({},r,(r={},r[k]=g.toDataURL(),r));s==null||s.setItem(d("StoriesConstants").CACHED_STORY_THUMBNAIL_URI_SESSION_STORAGE_KEY,JSON.stringify(k))}}c("QPLUserFlow").addPoint(c("qpl")._(741087294,"2028"),"Mutation started");d("CometRelay").commitMutation(e,{mutation:l,onCompleted:function(b){h!=null&&(i||(i=c("QuickPerformanceLogger"))).markerPoint(h,"mutation successful");c("cometComposerLogger")({fields:{composerType:"stories",loggingIds:(b=b.story_create)==null?void 0:b.logging_token},type:"COMPOSER_POST_SUCCESS"},a.composerSessionID);w&&w.dispose();c("QPLUserFlow").endSuccess(c("qpl")._(741087294,"2028"));p()},onError:function(b){var d;h!=null&&(i||(i=c("QuickPerformanceLogger"))).markerPoint(h,"mutation failed");c("cometComposerLogger")({fields:{composerType:"stories",errorDescription:typeof b.description==="string"?b.description:(d=b.description)==null?void 0:d.toString(),errorInfo:b.message},type:"COMPOSER_POST_FAILURE"},a.composerSessionID);w&&w.dispose();x&&x.dispose();c("QPLUserFlow").endFailure(c("qpl")._(741087294,"2028"),"Mutation failed");o(b)},variables:{input:babelHelpers["extends"]({},f)}})})}function n(a,b,e,f){var g=d("CometRelay").applyOptimisticMutation(a,{mutation:l,optimisticUpdater:function(a){c("storiesUploadUpdater")(a,e,f)},variables:{input:babelHelpers["extends"]({},b)}});return{dispose:function(){g&&g.dispose(),g=null}}}g.createStories=a}),98);